---
title: 评论回复数据设计
date: 2018-12-26 18:23:11
tags: [mysql]
categories: [技术,mysql]
---
一般评论都是同级展示，利用递归查出自评论，实现网易盖楼的评论套评论形式。
我自己上网查了一些大牛的想法，可以用分表的形式来让数据更简介分明。
有两种形式：
# 评论回复分表形式
同时也可以将评论拆分为评论表和回复表，评论挂在各种主题下面，而回复挂在评论下面。

评论表设计如下：

| 表字段	| 字段说明
|:-------:|:--------:|
| id	| 主键
| topic_id	| 主题id
| topic_type	| 主题类型
| content	| 评论内容
| from_uid	| 评论用户id

回复表设计：

| 表字段	| 字段说明 |
|:-------:|:-------: |
| id	| 主键

| comment_id	| 评论id
| reply_id	| 回复目标id
| reply_type	| 回复类型
| content	| 回复内容
| from_uid	| 回复用户id
| to_uid	| 目标用户id
由于我们拆分了评论和回复，那么评论表就不再需要目标用户字段了，因为评论均是用户对主题的评论，评论表的设计更佳简洁了。

回复表添加了一个comment_id字段来表示该回复挂在的根评论id，这样设计也是出于性能方面的考虑，我们可以直接通过评论id一次性的找出该评论下的所有回复，然后通过程序来编排回复的显示结构。 通过适当的冗余来提高性能也是常用的优化手段之一。

reply_type：表示回复的类型，因为回复可以是针对评论的回复(comment)，也可以是针对回复的回复(reply)， 通过这个字段来区分两种情景。

reply_id：表示回复目标的id，如果reply_type是comment的话，那么reply_id＝commit_id，如果reply_type是reply的话，这表示这条回复的父回复。
！

# 评论表，关系表分表

这种场景中评论和回复是同级显示的，回复不在显示结构上不用挂在一个评论下面。 双表的设计在这里就不太合适了，因为涉及到评论和回复的混排，使用双表则会导致查询的逻辑过于复杂。 所以建议还是采用单表的设计，不区分评论和回复会简化应用层的逻辑。 我们统一都看成评论，而有些评论是可以引用其他评论的。

（2）数据库设计

本人推荐采用闭包表的设计，例如：

comment表设计：

|表字段	|字段说明
|:-------:|:-------: |
|id	|主键
|topic_id	|主题id
|topic_type	|主题类型
|content	|评论内容
|from_uid	|评论用户id

parent_child表：

|表字段	|字段说明
|:-------:|:-------: |
|id	|主键
|parent_id	|父id
|child_id	|子id
comment表保存所有评论内容，而parent_children表则记录评论表中各个评论的父子关系。

查询时往往会按照时间排序，我们可以直接按id或者创建时间降序排列查询comment表即可。 如果用户想查询一条评论的完整引用，则可以通过parent_children来找到对应的路径。

闭包表在查询时非常方便，但是插入的性能稍差，因为除了插入评论表以外，还需要把该条评论所有的父子关系插入到父子关系表中。 插入性能会随着评论层级的加深而线性下降。